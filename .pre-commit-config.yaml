# Pre-commit hooks configuration for Aether-Defense-System
# Install: pip install pre-commit
# Setup: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--unsafe]  # Allow custom YAML tags
        exclude: ^deploy/helm/.*/templates/.*\.yaml$  # Exclude Helm templates
      - id: check-json
        # VS Code config files use JSON with comments (JSONC), so skip them here
        exclude: ^\.vscode/
      - id: check-toml
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: detect-private-key
      - id: mixed-line-ending
        args: [--fix=lf]

  # Go specific hooks
  # Note: go-fmt, go-vet, and go-lint are removed as they are covered by golangci-lint
  - repo: https://github.com/dnephin/pre-commit-golang
    rev: v0.5.1
    hooks:
      - id: go-cyclo
        # Newer gocyclo uses -over instead of -maxcyclo
        args: [--over=25]  # Max cyclomatic complexity threshold
      - id: go-unit-tests
        args: [-race, -short]  # Run tests with race detection
      - id: go-mod-tidy

  # golangci-lint
  # Temporarily disabled due to Go 1.25.5 compatibility issue with golang.org/x/tools@v0.24.0
  # Error: invalid array length -delta * delta (constant -256 of type int64)
  #
  # Workaround: golangci-lint is still run in CI pipeline with correct Go version
  # For local development, use IDE integration or run manually: golangci-lint run
  #
  # - repo: https://github.com/golangci/golangci-lint
  #   rev: v1.60.1
  #   hooks:
  #     - id: golangci-lint
  #       language_version: system
  #       args:
  #         - --timeout=5m
  #         - --config=.golangci.yml
  #       verbose: true

  # Commit message format check
  - repo: https://github.com/jorisroovers/gitlint
    rev: v0.19.1
    hooks:
      - id: gitlint
        args: [--contrib=contrib-title-conventional-commits]

  # YAML formatting
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types: [yaml]
        exclude: ^(\.golangci\.yml|\.pre-commit-config\.yaml|deploy/helm/.*/templates/.*\.yaml)$

  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.38.0
    hooks:
      - id: markdownlint
        # Auto-fix basic issues; relax some noisy rules for long, spec-style docs
        args:
          - --fix
          - --disable
          - MD013 # line length
          - --disable
          - MD041 # first line should be a top-level heading (templates start with H2)
        exclude: ^(CHANGELOG\.md|LICENSE)$

# Global configuration
default_language_version:
  python: python3
  # Use system-installed Node.js to avoid downloading prebuilt Node in CI/dev
  # This prevents nodeenv from trying to fetch https://nodejs.org/.../node-v18-*.tar.gz
  node: system
  # Use system Go version (1.25.5) for all Go hooks
  golang: system

# Exclude patterns
exclude: |
  (?x)^(
    \.git/|
    \.idea/|
    vendor/|
    node_modules/|
    \.pb\.go$|
    _gen\.go$
  )
